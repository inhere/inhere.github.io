# ZSH 自动补全脚本编写

告诉 zsh 使用哪个函数来完成命令

命令的完成函数存储在名称以下划线 `_` 开头的文件中，这些文件应放置在 `$fpath` 变量中列出的目录中。您可以通过在 `~/.zshrc` 文件中添加这样的行来向 `$fpath` 添加目录：

```bash
fpath=(~/newdir $fpath )
```

完成函数文件的第一行看起来像这样：

```bash
# compdef foobar
```

这告诉 zsh 该文件包含用于完成 foobar 命令的代码。这是第一行最常使用的格式，但如果需要，您也可以使用相同的文件来完成多个不同的功能。
请参阅[此处](http://zsh.sourceforge.net/Doc/Release/Completion-System.html#Autoloaded-files)了解更多详情。

你也可以直接使用 `compdef` 命令（例如在你的 `~/.zshrc` 文件中）告诉 zsh 使用哪个函数来完成这样的命令：


```bash
> compdef _function foobar
```

或者对几个命令使用相同的完成：

```bash
> compdef _function foobar goocar hoodar
```

或者如果你想提供参数：

```bash
> compdef ' _function arg1 arg2 ' foobar
```

请参[阅此](http://zsh.sourceforge.net/Doc/Release/Completion-System.html#Functions-4)处了解更多详情。

## 编写自己的完成函数

一个很好的入门方法是查看一些已经定义的完成函数。在我的 linux 安装中，这些可以在 `/usr/share/zsh/functions/Completion/Unix` 和 `/usr/share/zsh/functions/Completion/Linux` 和其他一些子目录中找到。

您会注意到 `_arguments` 函数在这些文件中被大量使用。这是一个实用函数，可以轻松编写简单的完成函数。`_arguments` 函数是 `compadd` 内置函数的包装器。`compadd` 内置函数是用于向命令行添加完成词并控制其行为的核心函数。
但是，大多数情况下您不需要使用 `compadd`，因为有许多实用函数，例如 `_arguments` 和 `_describe`，它们更易于使用。

对于非常基本的完成，`_describe` 函数应该足够了

### 实用功能

以下是一些可能有用的实用函数的列表。实用功能的完整列表以及完整的解释可在此处获得。下一节将给出如何使用这些函数的示例。

***整体完成的主要实用功能**

函数 | 说明
-----|-------
`_alternative`	| 可用于从其他实用程序函数或 shell 代码生成完成候选。
`_arguments`	| 用于指定如何完成带有 unix 样式选项的命令的单个选项和参数。
`_describe`	| 用于创建由带有描述（但没有动作 `ACTION`）的单词组成的简单完成。比 `_arguments` 更容易使用
`_gnu_generic` |	可用于完成理解 `--help` 选项的命令的选项。
`_regex_arguments` |	创建一个函数，用于将命令行参数与正则表达式匹配，然后执行操作/完成。

**用于执行单个单词的复杂完成的函数**

函数 | 说明
-----|-------
`_values` |用于完成任意关键字（值）及其参数，或此类组合的逗号分隔列表。
`_combination`   |  用于完成值的组合，例如主机名和用户名对。
`_multi_parts` |   用于分别完成单词的多个部分，其中每个部分由一些字符分隔，例如用于完成部分文件路径：`/u/i/sy -> /usr/include/sys`
`_sep_parts`  |    与 _multi_parts 类似，但允许在完成的不同部分使用不同的分隔符。
`_sequence`   |  用作另一个完成函数的包装器，以完成由该其他函数生成的分隔匹配列表。

**用于完成特定类型对象的函数**

函数 | 说明
-----|-------
`_path_files`  |    用于完成文件路径。采取多种选择来控制行为。
`_files`    |  使用除 `-g` 和 `-/` 之外的所有选项调用 `_path_files`。这些选项取决于文件模式样式设置。
`_net_interfaces` | 用于补全网络接口名称
`_users`   |   用于填写用户名
`_groups` | 用于完成组名
`_options`    |  用于补全 shell 选项的名称。
`_parameters`    |  用于完成 shell 参数/变量的名称（可以限制为匹配模式的那些）

**处理缓存完成的函数**

如果您有大量完成，您可以将它们保存在缓存文件中，以便快速加载完成。

函数 | 说明
-----|-------
`_cache_invalid` |  指示与给定缓存标识符对应的完成缓存是否需要重建
`_retrieve_cache` | 从缓存文件中检索完成信息
`_store_cache` |    在缓存文件中存储与给定缓存标识符相对应的完成

**其他功能**

函数 | 说明
-----|-------
`_message` |     用于在无法生成完成的地方显示帮助消息。
`_regex_words` |    可用于为 `_regex_arguments` 命令生成参数。这比手动编写参数更容易。
`_guard` |     可用于 `_arguments` 的规范的 `ACTION` 和类似函数来检查正在完成的单词。


> 本文翻译自 [zsh-users/zsh-completions](https://github.com/zsh-users/zsh-completions/blob/master/zsh-completions-howto.org)

