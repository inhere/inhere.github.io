<!doctype html><html lang=zh-Hans><head><meta charset=UTF-8><meta content="default-src 'self';font-src 'self' data:;img-src 'self' https://* data:;media-src 'self';style-src 'self';frame-src player.vimeo.com https://www.youtube-nocookie.com;connect-src 'self';script-src 'self' 'self'" http-equiv=Content-Security-Policy><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://inhere.github.io name=base><title>
Inhere's Site • 学习编写bash命令自动补全</title><link href=https://inhere.github.io/icons/favicon.ico rel=icon type=image/png><link title="Inhere's Site - Atom Feed" href=https://inhere.github.io/atom.xml rel=alternate type=application/atom+xml><link href="https://inhere.github.io/custom_subset.css?h=0b9535a28bc3d5bf2321" rel=stylesheet><link href="https://inhere.github.io/main.css?h=045c365e19a4d50a64bb" rel=stylesheet><link href="https://inhere.github.io/custom.css?h=b0b090835487d694b863" rel=stylesheet><link href="https://inhere.github.io/skins/blue.css?h=a4dc1e94d3f5759784d2" rel=stylesheet><meta content="light dark" name=color-scheme><meta content=简单学习编写bash命令自动补全… name=description><meta content=简单学习编写bash命令自动补全… property=og:description><meta content=学习编写bash命令自动补全 property=og:title><meta content=article property=og:type><meta content=zh_CN property=og:locale><meta content=https://inhere.github.io/blog/2021/08-09-learn-bash-completion/ property=og:url><meta content="Inhere's Site" property=og:site_name><noscript><link href=https://inhere.github.io/no_js.css rel=stylesheet></noscript><script src=https://inhere.github.io/js/initializeTheme.min.js></script><script defer src=https://inhere.github.io/js/themeSwitcher.min.js></script><body><a href=#main-content id=skip-link>跳到内容</a><header><nav class=navbar><div class=nav-title><a class=home-title href=https://inhere.github.io/>Inhere's Site</a></div><div class=nav-navs><ul><li><a class="nav-links no-hover-padding" href=https://inhere.github.io/blog/>📝 Blog </a><li><a class="nav-links no-hover-padding" href=https://inhere.github.io/projects/>🚀 Projects </a><li><a class="nav-links no-hover-padding" href=https://inhere.github.io/collections/>📚 Collections </a><li><a class="nav-links no-hover-padding" href=https://inhere.github.io/tags/>🏷️ Tags </a><li><a class="nav-links no-hover-padding" href=https://inhere.github.io/archive/>🗄️ Archive </a><li><a class="nav-links no-hover-padding" href=https://github.com/inhere>🐱 Github </a><li class=menu-icons-container><ul class=menu-icons-group><li class="theme-switcher-wrapper js"><div aria-label=切换到暗模式 aria-pressed=false class=theme-switcher role=button tabindex=0 title=切换到暗/亮模式></div><div class="theme-resetter arrow" aria-hidden=true aria-label=将模式重置为网站默认值 role=button tabindex=0 title=将模式重置为网站默认值></div></ul></ul></div></nav></header><div class=content id=main-content><main><article class=h-entry><h1 class="p-name article-title">学习编写bash命令自动补全</h1><a class="u-url u-uid" href=https://inhere.github.io/blog/2021/08-09-learn-bash-completion/></a><ul class=meta><span class="hidden p-author h-card"> <a class=u-url href=https://inhere.github.io rel=author title=Inhere>Inhere</a> </span><li><time class=dt-published datetime=2021-08-09T11:24:00>9 8月 2021</time><li title="1407 字"><span aria-hidden=true class=separator>•</span>8 分钟阅读</ul><section class="e-content body"><p>简单学习编写bash命令自动补全</p><span id=continue-reading></span><blockquote><p>下面的示例使用 <code>__my_completion</code> 作为命令行应用 <code>myapp</code>(eg: git) 的补全函数</blockquote><h2 id=xiang-guan-han-shu-shuo-ming><a aria-label="Anchor link for: xiang-guan-han-shu-shuo-ming" class="header-anchor no-hover-padding" href=#xiang-guan-han-shu-shuo-ming><span aria-hidden=true class=link-icon></span></a> 相关函数说明</h2><h3 id=complete-han-shu><a aria-label="Anchor link for: complete-han-shu" class="header-anchor no-hover-padding" href=#complete-han-shu><span aria-hidden=true class=link-icon></span></a> complete 函数</h3><p><code>complete</code> 指定命令的补全函数<p>自定义补全时调用complete命令来完成，complete通过选项提供了多种补全的途径和方式，这些选项是按照先后次序起作用的：<code>-A -G -W -F -C -X -P -S -o</code><p>一些选项说明:<ul><li><code>-o STRING</code> 额外设置补全选项，可以设置多次；选项值可以为： <ul><li><code>bashdefault</code> 如果没有生成补全条目，就使用bash默认的其它补全<li><code>default</code> 如果没有生成补全条目，就使用“readline”默认的文件名补全。<li><code>dirnames</code> 如果没有生成补全条目，就进行目录名补全。<li><code>filenames</code> 告诉“readline”生成文件名，以便进行与文件名相关的处理，例如在目录名后面加上斜杠，引用特殊字符，去掉行尾的空格，目的是用于shell函数。<li><code>noquote</code> 告诉“readline”不引用文件名，默认会进行引用。<li><code>nospace</code> 告诉“readline”在补全的名称后不添加空格，默认添加空格。<li><code>plusdirs</code> 生成补全条目之后，还会进行目录名补全并把结果添加到其它动作得到的结果中。</ul><li><code>-A STRING</code> action，指定动作，这个有固定的几个可选。选项值可以为： <ul><li><code>alias</code> 别名，同选项 <code>-a</code>。<li><code>arrayvar</code> 数组变量名。<li><code>binding</code> “readline”键绑定名。<li><code>builtin</code> shell内建命令名，同选项 <code>-b</code>。<li><code>command</code> 命令名，同选项 <code>-c</code>。<li><code>directory</code> 目录名，同选项 <code>-d</code>。<li><code>disabled</code> 不可用的shell内建命令名。<li><code>enabled</code> 可用的shell内建命令名。<li><code>export</code> 导出的shell变量名，同选项<code>-e</code>。<li><code>file</code> 文件名，同选项 <code>-f</code>。<li><code>function</code> shell函数名。<li><code>group</code> 组名，同选项 <code>-g</code>。<li><code>helptopic</code> 内建命令help支持的帮助主题。<li><code>hostname</code> 主机名，从shell环境变量HOSTFILE中获取。<li><code>job</code> 作业名，同选项 <code>-j</code>。<li><code>keyword</code> shell保留字，同选项 <code>-k</code>。<li><code>running</code> 正在运行的作业名。<li><code>service</code> 服务名，同选项 <code>-s</code>。<li><code>setopt</code> 内建命令set的选项 <code>-o</code> 可用的参数。<li><code>shopt</code> 内建命令shopt可接受的选项名。<li><code>signal</code> 信号名。<li><code>stopped</code> 暂停的作业名。<li><code>user</code> 用户名，同选项 <code>-u</code>。<li><code>variable</code> 所有的shell变量名，同选项 <code>-v</code>。</ul><li><code>-C command</code> 在子shell中执行命令，并把其结果作为补全条目。<li><code>-F function</code> 指定function生成可选单词。 <ul><li>在函数定义中，一些shell变量可以使用：<code>COMP_LINE</code>, <code>COMP_POINT</code>, <code>COMP_KEY</code>, <code>COMP_TYPE</code>。<li>函数参数定义是：<code>$1</code> 为当前要补全参数的命令，<code>$2</code> 为当前要补全的单词，<code>$3</code> 为当前要补全单词的前面一个单词。<li>这些都可以在自定义函数中使用。最终单词列表要放到 <code>COMPREPLY</code> 这个数组中，shell补全机制是从这个数组中取单词的。</ul><li><code>-G globpat</code> 使用文件名扩展模式globpat进行扩展以生成可能的补全条目。<li><code>-P prefix</code> 在所有的选项应用到补全结果后，在结果前添加前缀prefix。<li><code>-S suffix</code> 在所有的选项应用到补全结果后，在结果后添加后缀suffix。<li><code>-W wordlist</code> 使用特殊变量 <code>IFS</code> 中的字符拆分单词列表wordlist，并扩展拆分后的每个单词，结果中与待补全单词匹配的条目就是补全条目。<li><code>-X filterpat</code> filterpat是进行文件名扩展时使用的模式，它作用于通过前面的选项和参数生成的补全列表，并把每个与过滤模式匹配的条目删除，模式中前导的叹号表示否定，这时会删除与过滤模式不匹配的条目。</ul><blockquote><p>TIP: <code>IFS</code> 内部字段分隔符。 用于迭代字符串，例如：<code>data="a,b,c"</code> 设置 <code>local IFS=","</code> , 使用 <code>for item in $data</code> 迭代字符串，内部item 即是单个的 <code>a</code> <code>b</code> <code>c</code></blockquote><p>** -F 补充说明：**<ul><li><p><code>COMPREPLY</code> 变量的内容总是会显示，补全函数需要自己处理其中的内容。</p><li><p>如果 <code>COMPREPLY</code> 变量中只有一个元素，那么这个词会自动补全到命令之后。返回多个候选则不会触发这个功能。</p><li><p><code>COMP_WORDS</code>：当前命令行中已经输入的词数组。</p><li><p><code>COMP_CWORD</code>：当前光标所处词位于 <code>COMP_WORDS</code> 数组中的索引值。既当按下 tab 键时光标所处词的索引。</p><li><p><code>COMP_LINE</code>：当前命令行。</p></ul><p>获取命令后面的词，我们可以使用 <code>COMP_WORDS[1]</code> 的值<h3 id=compgen-han-shu><a aria-label="Anchor link for: compgen-han-shu" class="header-anchor no-hover-padding" href=#compgen-han-shu><span aria-hidden=true class=link-icon></span></a> compgen 函数</h3><p><code>compgen</code> 是一个用于生成补全列表的内置命令，支持complete命令的大部分参数（例如-W参数指定补全词列表，-d参数补全目录），并能够 <strong>基于用户已经输入的内容进行过滤</strong><pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> compgen<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>help</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">compgen:</span></span><span class="z-meta z-function-call z-arguments z-shell"> compgen <span class="z-keyword z-control z-regexp z-set z-begin z-shell">[</span>-abcdefgjksuv<span class="z-keyword z-control z-regexp z-set z-end z-shell">]</span> <span class="z-keyword z-control z-regexp z-set z-begin z-shell">[</span>-o option<span class="z-keyword z-control z-regexp z-set z-end z-shell">]</span> <span class="z-keyword z-control z-regexp z-set z-begin z-shell">[</span>-A action<span class="z-keyword z-control z-regexp z-set z-end z-shell">]</span> <span class="z-keyword z-control z-regexp z-set z-begin z-shell">[</span>-G globpat<span class="z-keyword z-control z-regexp z-set z-end z-shell">]</span> <span class="z-keyword z-control z-regexp z-set z-begin z-shell">[</span>-W wordlist<span class="z-keyword z-control z-regexp z-set z-end z-shell">]</span>  <span class="z-keyword z-control z-regexp z-set z-begin z-shell">[</span>-F function<span class="z-keyword z-control z-regexp z-set z-end z-shell">]</span> <span class="z-keyword z-control z-regexp z-set z-begin z-shell">[</span>-C command<span class="z-keyword z-control z-regexp z-set z-end z-shell">]</span> <span class="z-keyword z-control z-regexp z-set z-begin z-shell">[</span>-X filterpat<span class="z-keyword z-control z-regexp z-set z-end z-shell">]</span> <span class="z-keyword z-control z-regexp z-set z-begin z-shell">[</span>-P prefix<span class="z-keyword z-control z-regexp z-set z-end z-shell">]</span> <span class="z-keyword z-control z-regexp z-set z-begin z-shell">[</span>-S suffix<span class="z-keyword z-control z-regexp z-set z-end z-shell">]</span> <span class="z-keyword z-control z-regexp z-set z-begin z-shell">[</span>word<span class="z-keyword z-control z-regexp z-set z-end z-shell">]</span></span>
</span></code></pre><table><thead><tr><th>选项<th>选项值<th>说明<tbody><tr><td><code>-F</code><td>function<td>执行shell 函数，函数中生成COMPREPLY作为候选的补全结果<tr><td><code>-C</code><td>command<td>将 command 命令的执行结果作为候选的补全 结果<tr><td><code>-G</code><td>pattern<td>将匹配 pattern的文件名作为候选的补全结果<tr><td><code>-W</code><td>wordlist<td>分割 wordlist 中的单词，作为候选的补全结果<tr><td><code>-p</code><td><code>[name]</code><td>列出当前所有的补全命令<tr><td><code>-r</code><td><code>[name]</code><td>删除某个补全命令</table><p>测试使用：<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> compgen<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>W</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>one two three<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">one</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">two</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">three</span></span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">inhere@Inhere-win10</span></span><span class="z-meta z-function-call z-arguments z-shell"> MINGW64 /f/work (main</span><span class="z-meta z-function-call z-shell"></span>)
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> compgen<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>W</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>one two three<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> o</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">one</span></span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">inhere@Inhere-win10</span></span><span class="z-meta z-function-call z-arguments z-shell"> MINGW64 /f/work (main</span><span class="z-meta z-function-call z-shell"></span>)
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> compgen<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>W</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>one two three<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span> t</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">two</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">three</span></span>
</span></code></pre><h3 id=bang-zhu-diao-shi><a aria-label="Anchor link for: bang-zhu-diao-shi" class="header-anchor no-hover-padding" href=#bang-zhu-diao-shi><span aria-hidden=true class=link-icon></span></a> 帮助调试</h3><pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> 打印全部已定义的函数名称</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-storage z-modifier z-shell">declare</span> <span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">-</span>F</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> 查看指定函数的定义</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-storage z-modifier z-shell">declare</span> <span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">-</span>f</span> <span class="z-variable z-other z-readwrite z-assignment z-shell">__my_completion</span></span>
</span></code></pre><h2 id=fen-ge-dan-ci-lie-biao-zuo-wei-bu-quan-shu-ju><a aria-label="Anchor link for: fen-ge-dan-ci-lie-biao-zuo-wei-bu-quan-shu-ju" class="header-anchor no-hover-padding" href=#fen-ge-dan-ci-lie-biao-zuo-wei-bu-quan-shu-ju><span aria-hidden=true class=link-icon></span></a> 分割单词列表作为补全数据</h2><pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell">!/usr/bin/env bash</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell"><span class="z-entity z-name z-function z-shell">__my_completion</span> <span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-punctuation z-section z-parens z-end z-shell">)</span> <span class="z-punctuation z-section z-braces z-begin z-shell">{</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-variable z-other z-readwrite z-assignment z-shell">cur_name</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-expansion z-parameter z-begin z-shell">{</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-variable z-other z-readwrite z-shell">COMP_WORDS<span class="z-punctuation z-section z-braces z-begin z-shell">[</span>COMP_CWORD<span class="z-punctuation z-section z-braces z-end z-shell">]</span></span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-section z-expansion z-parameter z-end z-shell">}</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> 候选命令</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-variable z-other z-readwrite z-assignment z-shell">commands</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>one two three<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-variable z-other z-readwrite z-assignment z-shell">COMPREPLY</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">compgen</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>W</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">commands</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span><span class="z-keyword z-operator z-end-of-options z-shell"> --</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">cur_name</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell"><span class="z-punctuation z-section z-braces z-end z-shell">}</span></span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">complete</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>F</span> __my_completion myapp</span>
</span></code></pre><h2 id=shi-yong-echofan-hui-zuo-wei-bu-quan-shu-ju><a aria-label="Anchor link for: shi-yong-echofan-hui-zuo-wei-bu-quan-shu-ju" class="header-anchor no-hover-padding" href=#shi-yong-echofan-hui-zuo-wei-bu-quan-shu-ju><span aria-hidden=true class=link-icon></span></a> 使用echo返回作为补全数据</h2><p>简单的使用echo返回作为补全数据<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell"><span class="z-entity z-name z-function z-shell">__my_completion</span> <span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-punctuation z-section z-parens z-end z-shell">)</span> <span class="z-punctuation z-section z-braces z-begin z-shell">{</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> 候选命令</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-variable z-other z-readwrite z-assignment z-shell">commands</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>one two three<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">commands</span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell"><span class="z-punctuation z-section z-braces z-end z-shell">}</span></span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> for use echo</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">complete</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>o</span> dirnames<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>C</span> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>__my_completion<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span> myapp</span>
</span></code></pre><h2 id=shi-yong-wai-bu-han-shu-de-jie-guo-bu-quan><a aria-label="Anchor link for: shi-yong-wai-bu-han-shu-de-jie-guo-bu-quan" class="header-anchor no-hover-padding" href=#shi-yong-wai-bu-han-shu-de-jie-guo-bu-quan><span aria-hidden=true class=link-icon></span></a> 使用外部函数的结果补全</h2><pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell"><span class="z-entity z-name z-function z-shell">__my_completion</span> <span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-punctuation z-section z-parens z-end z-shell">)</span> <span class="z-punctuation z-section z-braces z-begin z-shell">{</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> 输入的关键词</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell"><span class="z-meta z-function-call z-shell">    <span class="z-storage z-modifier z-shell">local</span> <span class="z-variable z-other z-readwrite z-assignment z-shell">term</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-expansion z-parameter z-begin z-shell">{</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-variable z-other z-readwrite z-shell">COMP_WORDS<span class="z-punctuation z-section z-braces z-begin z-shell">[</span>COMP_CWORD<span class="z-punctuation z-section z-braces z-end z-shell">]</span></span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-section z-expansion z-parameter z-end z-shell">}</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> 使用外部命令来匹配关键词并返回结果</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell"><span class="z-meta z-function-call z-shell">    <span class="z-storage z-modifier z-shell">local</span> <span class="z-variable z-other z-readwrite z-assignment z-shell">commands</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">kite</span></span><span class="z-meta z-function-call z-arguments z-shell"> jump hint <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">term</span></span><span class="z-punctuation z-definition z-string z-end z-shell">"</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>no-name</span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell">    echo commands:</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell">    echo $commands --- ${commands[@]}</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-variable z-other z-readwrite z-assignment z-shell">COMPREPLY</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">commands</span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell"><span class="z-punctuation z-section z-braces z-end z-shell">}</span></span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> for use echo</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">complete</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>o</span> dirnames<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>F</span> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>__my_completion<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span> myapp</span>
</span></code></pre><blockquote><p>TIP: 编写好之后，可以使用 <code>source ./my_complete.sh</code> 临时加载到bash; 要保持一直生效需要配置到 <code>.bashrc</code></blockquote><blockquote><p>参考文章链接：<ul><li>https://blog.csdn.net/qq_38883889/article/details/106543271<li>https://blog.csdn.net/junyidcf/article/details/54178196<li>https://www.infoq.cn/article/bash-programmable-completion-tutorial</ul></blockquote></section></article></main><div id=button-container><div id=toc-floating-container><input class=toggle id=toc-toggle type=checkbox><label class=button for=toc-toggle id=toc-button title=切换目录><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="M414.82-193.094q-18.044 0-30.497-12.32-12.453-12.319-12.453-30.036t12.453-30.086q12.453-12.37 30.497-12.37h392.767q17.237 0 29.927 12.487 12.69 12.486 12.69 30.203 0 17.716-12.69 29.919t-29.927 12.203H414.82Zm0-244.833q-18.044 0-30.497-12.487Q371.87-462.9 371.87-480.45t12.453-29.92q12.453-12.369 30.497-12.369h392.767q17.237 0 29.927 12.511 12.69 12.512 12.69 29.845 0 17.716-12.69 30.086-12.69 12.37-29.927 12.37H414.82Zm0-245.167q-18.044 0-30.497-12.32t-12.453-30.037q0-17.716 12.453-30.086 12.453-12.369 30.497-12.369h392.767q17.237 0 29.927 12.486 12.69 12.487 12.69 30.203 0 17.717-12.69 29.92-12.69 12.203-29.927 12.203H414.82ZM189.379-156.681q-32.652 0-55.878-22.829t-23.226-55.731q0-32.549 23.15-55.647 23.151-23.097 55.95-23.097 32.799 0 55.313 23.484 22.515 23.484 22.515 56.246 0 32.212-22.861 54.893-22.861 22.681-54.963 22.681Zm0-245.167q-32.652 0-55.878-23.134-23.226-23.135-23.226-55.623 0-32.487 23.467-55.517t56.12-23.03q32.102 0 54.721 23.288 22.62 23.288 22.62 55.775 0 32.488-22.861 55.364-22.861 22.877-54.963 22.877Zm-.82-244.833q-32.224 0-55.254-23.288-23.03-23.289-23.03-55.623 0-32.333 23.271-55.364 23.272-23.03 55.495-23.03 32.224 0 55.193 23.288 22.969 23.289 22.969 55.622 0 32.334-23.21 55.364-23.21 23.031-55.434 23.031Z"/></svg></label><div class=toc-content><div class=toc-container><ul><li><a href=https://inhere.github.io/blog/2021/08-09-learn-bash-completion/#xiang-guan-han-shu-shuo-ming>相关函数说明</a> <ul><li><a href=https://inhere.github.io/blog/2021/08-09-learn-bash-completion/#complete-han-shu>complete 函数</a><li><a href=https://inhere.github.io/blog/2021/08-09-learn-bash-completion/#compgen-han-shu>compgen 函数</a><li><a href=https://inhere.github.io/blog/2021/08-09-learn-bash-completion/#bang-zhu-diao-shi>帮助调试</a></ul><li><a href=https://inhere.github.io/blog/2021/08-09-learn-bash-completion/#fen-ge-dan-ci-lie-biao-zuo-wei-bu-quan-shu-ju>分割单词列表作为补全数据</a><li><a href=https://inhere.github.io/blog/2021/08-09-learn-bash-completion/#shi-yong-echofan-hui-zuo-wei-bu-quan-shu-ju>使用echo返回作为补全数据</a><li><a href=https://inhere.github.io/blog/2021/08-09-learn-bash-completion/#shi-yong-wai-bu-han-shu-de-jie-guo-bu-quan>使用外部函数的结果补全</a></ul></div></div></div><a class=no-hover-padding href=# id=top-button title=返回页面顶部> <svg viewbox="0 0 20 20" fill=currentColor><path d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z"/></svg> </a></div><span class=hidden id=copy-success> 已复制! </span><span class=hidden id=copy-init> 复制代码到剪贴板 </span><script defer src=https://inhere.github.io/js/copyCodeToClipboard.min.js></script></div><footer><section><nav class="socials nav-navs"><ul><li><a class="nav-links no-hover-padding social" rel="noopener noreferrer" href=https://inhere.github.io/atom.xml target=_blank> <img alt=feed loading=lazy src=https://inhere.github.io/social_icons/rss.svg title=feed> </a><li><a class="nav-links no-hover-padding social" rel="noopener noreferrer me" href=https://github.com/inhere/ target=_blank> <img alt=github loading=lazy src=https://inhere.github.io/social_icons/github.svg title=github> </a></ul></nav><nav class=nav-navs><small> <ul><li><a class="nav-links no-hover-padding" href=https://inhere.github.io/pages/about> 🐶 About </a><li><a class="nav-links no-hover-padding" href=https://github.com/gookit> 🐱 Gookit </a><li><a class="nav-links no-hover-padding" href=https://github.com/phppkg> 🐱 PHPPkg </a><li><a class="nav-links no-hover-padding" href=https://inhere.github.io/sitemap.xml> 📄 Sitemap </a></ul> </small></nav><div class=credits><small> 网站基于 <a rel="noopener noreferrer" href=https://www.getzola.org target=_blank>Zola</a> 和 <a rel="noopener noreferrer" href=https://github.com/welpo/tabi target=_blank>tabi</a> • <a rel="noopener noreferrer" href=https://github.com/inhere/inhere.github.io target=_blank> 查看原始码 </a></small></div></section></footer>