<!doctype html><html lang=zh-Hans><head><meta charset=UTF-8><meta content="default-src 'self';font-src 'self' data:;img-src 'self' https://* data:;media-src 'self';style-src 'self';frame-src player.vimeo.com https://www.youtube-nocookie.com;connect-src 'self';script-src 'self' 'self'" http-equiv=Content-Security-Policy><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://inhere.github.io name=base><title>
Inhere's Site • Linux 命令神器 lsof 入门</title><link href=https://inhere.github.io/icons/favicon.ico rel=icon type=image/png><link title="Inhere's Site - Atom Feed" href=https://inhere.github.io/atom.xml rel=alternate type=application/atom+xml><link href="https://inhere.github.io/custom_subset.css?h=0b9535a28bc3d5bf2321" rel=stylesheet><link href="https://inhere.github.io/main.css?h=045c365e19a4d50a64bb" rel=stylesheet><link href="https://inhere.github.io/custom.css?h=b0b090835487d694b863" rel=stylesheet><link href="https://inhere.github.io/skins/blue.css?h=a4dc1e94d3f5759784d2" rel=stylesheet><meta content="light dark" name=color-scheme><meta content="lsof 是系统管理/安全的尤伯工具。大多数时候用它来从系统获得与网络连接相关的信息，但那只是这个强大而又鲜为人知的应用的第一步。…" name=description><meta content="lsof 是系统管理/安全的尤伯工具。大多数时候用它来从系统获得与网络连接相关的信息，但那只是这个强大而又鲜为人知的应用的第一步。…" property=og:description><meta content="Linux 命令神器 lsof 入门" property=og:title><meta content=article property=og:type><meta content=zh_CN property=og:locale><meta content=https://inhere.github.io/blog/2016/lsof-command-usage-in-linux/ property=og:url><meta content="Inhere's Site" property=og:site_name><noscript><link href=https://inhere.github.io/no_js.css rel=stylesheet></noscript><script src=https://inhere.github.io/js/initializeTheme.min.js></script><script defer src=https://inhere.github.io/js/themeSwitcher.min.js></script><body><a href=#main-content id=skip-link>跳到内容</a><header><nav class=navbar><div class=nav-title><a class=home-title href=https://inhere.github.io/>Inhere's Site</a></div><div class=nav-navs><ul><li><a class="nav-links no-hover-padding" href=https://inhere.github.io/blog/>📝 Blog </a><li><a class="nav-links no-hover-padding" href=https://inhere.github.io/projects/>🚀 Projects </a><li><a class="nav-links no-hover-padding" href=https://inhere.github.io/collections/>📚 Collections </a><li><a class="nav-links no-hover-padding" href=https://inhere.github.io/tags/>🏷️ Tags </a><li><a class="nav-links no-hover-padding" href=https://inhere.github.io/archive/>🗄️ Archive </a><li><a class="nav-links no-hover-padding" href=https://github.com/inhere>🐱 Github </a><li class=menu-icons-container><ul class=menu-icons-group><li class="theme-switcher-wrapper js"><div aria-label=切换到暗模式 aria-pressed=false class=theme-switcher role=button tabindex=0 title=切换到暗/亮模式></div><div class="theme-resetter arrow" aria-hidden=true aria-label=将模式重置为网站默认值 role=button tabindex=0 title=将模式重置为网站默认值></div></ul></ul></div></nav></header><div class=content id=main-content><main><article class=h-entry><h1 class="p-name article-title">Linux 命令神器 lsof 入门</h1><a class="u-url u-uid" href=https://inhere.github.io/blog/2016/lsof-command-usage-in-linux/></a><ul class=meta><span class="hidden p-author h-card"> <a class=u-url href=https://inhere.github.io rel=author title=Inhere>Inhere</a> </span><li><time class=dt-published datetime=2016-08-20T14:00:34>20 8月 2016</time><li title="1521 字"><span aria-hidden=true class=separator>•</span>8 分钟阅读<li class=tag><span aria-hidden=true class=separator>•</span>标签: <li class=tag><a class=p-category href=https://inhere.github.io/tags/linux/>linux</a>, <li class=tag><a class=p-category href=https://inhere.github.io/tags/lsof/>lsof</a>, <li class=tag><a class=p-category href=https://inhere.github.io/tags/tools/>tools</a></ul><section class="e-content body"><p><code>lsof</code> 是系统管理/安全的尤伯工具。大多数时候用它来从系统获得与网络连接相关的信息，但那只是这个强大而又鲜为人知的应用的第一步。</p><span id=continue-reading></span><p>将这个工具称之为 <code>lsof</code> 真是名副其实，因为它是指“<strong>列出打开文件（lists openfiles）</strong>”。而有一点要切记，<strong>在Unix中一切（包括网络套接口）都是文件</strong>。<p>有趣的是，lsof也是有着最多开关的Linux/Unix命令之一。它有那么多的开关，它有许多选项支持使用<code>-</code>和<code>+</code>前缀。<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> lsof</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">usage:</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-keyword z-control z-regexp z-set z-begin z-shell">[</span>-<span class="z-keyword z-operator z-regexp z-quantifier z-shell">?</span>abhlnNoOPRstUvV<span class="z-keyword z-control z-regexp z-set z-end z-shell">]</span> <span class="z-keyword z-control z-regexp z-set z-begin z-shell">[</span>+|<span class="z-keyword z-operator z-word z-shell">-</span>c c<span class="z-keyword z-control z-regexp z-set z-end z-shell">]</span> <span class="z-keyword z-control z-regexp z-set z-begin z-shell">[</span>+|<span class="z-keyword z-operator z-word z-shell">-</span>d s<span class="z-keyword z-control z-regexp z-set z-end z-shell">]</span> <span class="z-keyword z-control z-regexp z-set z-begin z-shell">[</span>+D D<span class="z-keyword z-control z-regexp z-set z-end z-shell">]</span> <span class="z-keyword z-control z-regexp z-set z-begin z-shell">[</span>+|<span class="z-keyword z-operator z-word z-shell">-</span>f[cgG<span class="z-keyword z-control z-regexp z-set z-end z-shell">]</span>]</span>
</span><span class="z-source z-shell z-bash"> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[-F</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-keyword z-control z-regexp z-set z-begin z-shell">[</span>f<span class="z-keyword z-control z-regexp z-set z-end z-shell">]</span>] <span class="z-keyword z-control z-regexp z-set z-begin z-shell">[</span>-g [s<span class="z-keyword z-control z-regexp z-set z-end z-shell">]</span>] <span class="z-keyword z-control z-regexp z-set z-begin z-shell">[</span>-i [i<span class="z-keyword z-control z-regexp z-set z-end z-shell">]</span>] <span class="z-keyword z-control z-regexp z-set z-begin z-shell">[</span>+|<span class="z-keyword z-operator z-word z-shell">-</span>L [l<span class="z-keyword z-control z-regexp z-set z-end z-shell">]</span>] <span class="z-keyword z-control z-regexp z-set z-begin z-shell">[</span>+|<span class="z-keyword z-operator z-word z-shell">-</span>M<span class="z-keyword z-control z-regexp z-set z-end z-shell">]</span> <span class="z-keyword z-control z-regexp z-set z-begin z-shell">[</span>-o [o<span class="z-keyword z-control z-regexp z-set z-end z-shell">]</span>]</span>
</span><span class="z-source z-shell z-bash"> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[-p</span></span><span class="z-meta z-function-call z-arguments z-shell"> s] <span class="z-keyword z-control z-regexp z-set z-begin z-shell">[</span>+|<span class="z-keyword z-operator z-word z-shell">-</span>r [t<span class="z-keyword z-control z-regexp z-set z-end z-shell">]</span>] <span class="z-keyword z-control z-regexp z-set z-begin z-shell">[</span>-S [t<span class="z-keyword z-control z-regexp z-set z-end z-shell">]</span>] <span class="z-keyword z-control z-regexp z-set z-begin z-shell">[</span>-T [t<span class="z-keyword z-control z-regexp z-set z-end z-shell">]</span>] <span class="z-keyword z-control z-regexp z-set z-begin z-shell">[</span>-u s<span class="z-keyword z-control z-regexp z-set z-end z-shell">]</span> <span class="z-keyword z-control z-regexp z-set z-begin z-shell">[</span>+|<span class="z-keyword z-operator z-word z-shell">-</span>w<span class="z-keyword z-control z-regexp z-set z-end z-shell">]</span> <span class="z-keyword z-control z-regexp z-set z-begin z-shell">[</span>-x [fl<span class="z-keyword z-control z-regexp z-set z-end z-shell">]</span>] <span class="z-keyword z-control z-regexp z-set z-begin z-shell">[</span>--<span class="z-keyword z-control z-regexp z-set z-end z-shell">]</span> <span class="z-keyword z-control z-regexp z-set z-begin z-shell">[</span>names<span class="z-keyword z-control z-regexp z-set z-end z-shell">]</span></span>
</span></code></pre><p>正如你所见，lsof有着实在是令人惊讶的选项数量。你可以使用它来获得你系统上设备的信息，你能通过它了解到指定的用户在指定的地点正在碰什么东西，或者甚至是一个进程正在使用什么文件或网络连接。<p>对于我，lsof替代了netstat和ps的全部工作。它可以带来那些工具所能带来的一切，而且要比那些工具多得多。那么，让我们来看看它的一些基本能力吧：<h2 id=guan-jian-xuan-xiang><a aria-label="Anchor link for: guan-jian-xuan-xiang" class="header-anchor no-hover-padding" href=#guan-jian-xuan-xiang><span aria-hidden=true class=link-icon></span></a> 关键选项</h2><p>理解一些关于lsof如何工作的关键性东西是很重要的。最重要的是，当你给它传递选项时，默认行为是对结果进行“或”运算。因此，如果你正是用-i来拉出一个端口列表，同时又用-p来拉出一个进程列表，那么默认情况下你会获得两者的结果。<p>下面的一些其它东西需要牢记：<ul><li>默认 : 没有选项，lsof列出活跃进程的所有打开文件<li>组合 : 可以将选项组合到一起，如-abc，但要当心哪些选项需要参数<li>-a : 结果进行“与”运算（而不是“或”）<li>-l : 在输出显示用户ID而不是用户名<li>-h : 获得帮助<li>-t : 仅获取进程ID<li>-U : 获取UNIX套接口地址<li>-F : 格式化输出结果，用于其它命令。可以通过多种方式格式化，如-F pcfn（用于进程id、命令名、文件描述符、文件名，并以空终止）</ul><h2 id=huo-qu-wang-luo-xin-xi><a aria-label="Anchor link for: huo-qu-wang-luo-xin-xi" class="header-anchor no-hover-padding" href=#huo-qu-wang-luo-xin-xi><span aria-hidden=true class=link-icon></span></a> 获取网络信息</h2><p>正如我所说的，我主要将lsof用于获取关于系统怎么和网络交互的信息。这里提供了关于此信息的一些主题：<h3 id=shi-yong-ixian-shi-suo-you-lian-jie><a aria-label="Anchor link for: shi-yong-ixian-shi-suo-you-lian-jie" class="header-anchor no-hover-padding" href=#shi-yong-ixian-shi-suo-you-lian-jie><span aria-hidden=true class=link-icon></span></a> 使用-i显示所有连接</h3><p>有些人喜欢用netstat来获取网络连接，但是我更喜欢使用lsof来进行此项工作。结果以对我来说很直观的方式呈现，我仅仅只需改变我的语法，就可以通过同样的命令来获取更多信息。<pre class=z-code><code><span class="z-text z-plain"># lsof -i
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">COMMAND  PID USER   FD   TYPE DEVICE SIZE NODE NAME
</span><span class="z-text z-plain">dhcpcd 6061 root 4u IPv4 4510 UDP *:bootpc
</span><span class="z-text z-plain">sshd 7703 root 3u IPv6  6499 TCP *:ssh (LISTEN)
</span><span class="z-text z-plain">sshd 7892 root 3u IPv6  6757 TCP 10.10.1.5:ssh->192.168.1.5:49901 (ESTABLISHED)
</span></code></pre><h3 id=shi-yong-i-6jin-huo-qu-ipv6liu-liang><a aria-label="Anchor link for: shi-yong-i-6jin-huo-qu-ipv6liu-liang" class="header-anchor no-hover-padding" href=#shi-yong-i-6jin-huo-qu-ipv6liu-liang><span aria-hidden=true class=link-icon></span></a> 使用-i 6仅获取IPv6流量</h3><pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> lsof<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>i</span> 6</span>
</span></code></pre><h3 id=jin-xian-shi-tcplian-jie-tong-li-ke-huo-de-udplian-jie><a aria-label="Anchor link for: jin-xian-shi-tcplian-jie-tong-li-ke-huo-de-udplian-jie" class="header-anchor no-hover-padding" href=#jin-xian-shi-tcplian-jie-tong-li-ke-huo-de-udplian-jie><span aria-hidden=true class=link-icon></span></a> 仅显示TCP连接（同理可获得UDP连接）</h3><p>你也可以通过在-i后提供对应的协议来仅仅显示TCP或者UDP连接信息。<h1 id=lsof-itcp><a aria-label="Anchor link for: lsof-itcp" class="header-anchor no-hover-padding" href=#lsof-itcp><span aria-hidden=true class=link-icon></span></a> lsof -iTCP</h1><pre class=z-code><code><span class="z-text z-plain">$ lsof -iTCP
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">COMMAND  PID USER   FD   TYPE DEVICE SIZE NODE NAME
</span><span class="z-text z-plain">sshd 7703 root 3u IPv6 6499 TCP *:ssh (LISTEN)
</span><span class="z-text z-plain">sshd 7892 root 3u IPv6 6757 TCP 10.10.1.5:ssh->192.168.1.5:49901 (ESTABLISHED)
</span></code></pre><h3 id=shi-yong-i-portlai-xian-shi-yu-zhi-ding-duan-kou-xiang-guan-de-wang-luo-xin-xi><a aria-label="Anchor link for: shi-yong-i-portlai-xian-shi-yu-zhi-ding-duan-kou-xiang-guan-de-wang-luo-xin-xi" class="header-anchor no-hover-padding" href=#shi-yong-i-portlai-xian-shi-yu-zhi-ding-duan-kou-xiang-guan-de-wang-luo-xin-xi><span aria-hidden=true class=link-icon></span></a> 使用-i:port来显示与指定端口相关的网络信息</h3><p>或者，你也可以通过端口搜索，这对于要找出什么阻止了另外一个应用绑定到指定端口实在是太棒了。<pre class=z-code><code><span class="z-text z-plain"># lsof -i:22
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">COMMAND  PID USER   FD   TYPE DEVICE SIZE NODE NAME
</span><span class="z-text z-plain">sshd 7703 root 3u  IPv6 6499 TCP *:ssh (LISTEN)
</span><span class="z-text z-plain">sshd 7892 root 3u  IPv6 6757 TCP 10.10.1.5:ssh->192.168.1.5:49901 (ESTABLISHED)
</span></code></pre><h3 id=shi-yong-hostlai-xian-shi-zhi-ding-dao-zhi-ding-zhu-ji-de-lian-jie><a aria-label="Anchor link for: shi-yong-hostlai-xian-shi-zhi-ding-dao-zhi-ding-zhu-ji-de-lian-jie" class="header-anchor no-hover-padding" href=#shi-yong-hostlai-xian-shi-zhi-ding-dao-zhi-ding-zhu-ji-de-lian-jie><span aria-hidden=true class=link-icon></span></a> 使用@host来显示指定到指定主机的连接</h3><p>这对于你在检查是否开放连接到网络中或互联网上某个指定主机的连接时十分有用。<pre class=z-code><code><span class="z-text z-plain"># lsof -i@172.16.12.5
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">sshd 7892 root 3u IPv6 6757 TCP 10.10.1.5:ssh->172.16.12.5:49901 (ESTABLISHED)
</span></code></pre><h3 id=shi-yong-host-portxian-shi-ji-yu-zhu-ji-yu-duan-kou-de-lian-jie><a aria-label="Anchor link for: shi-yong-host-portxian-shi-ji-yu-zhu-ji-yu-duan-kou-de-lian-jie" class="header-anchor no-hover-padding" href=#shi-yong-host-portxian-shi-ji-yu-zhu-ji-yu-duan-kou-de-lian-jie><span aria-hidden=true class=link-icon></span></a> 使用@host:port显示基于主机与端口的连接</h3><p>你也可以组合主机与端口的显示信息。<pre class=z-code><code><span class="z-text z-plain"># lsof -i@172.16.12.5:22
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">sshd 7892 root 3u IPv6 6757 TCP 10.10.1.5:ssh->172.16.12.5:49901 (ESTABLISHED)
</span></code></pre><h3 id=zhao-chu-jian-ting-duan-kou><a aria-label="Anchor link for: zhao-chu-jian-ting-duan-kou" class="header-anchor no-hover-padding" href=#zhao-chu-jian-ting-duan-kou><span aria-hidden=true class=link-icon></span></a> 找出监听端口</h3><p>找出正等候连接的端口。<pre class=z-code><code><span class="z-text z-plain"># lsof -i -sTCP:LISTEN
</span></code></pre><p>你也可以grep “LISTEN”来完成该任务。<pre class=z-code><code><span class="z-text z-plain"># lsof -i | grep -i LISTEN
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">iTunes     400 daniel   16u  IPv4 0x4575228  0t0 TCP *:daap (LISTEN)
</span></code></pre><h3 id=zhao-chu-yi-jian-li-de-lian-jie><a aria-label="Anchor link for: zhao-chu-yi-jian-li-de-lian-jie" class="header-anchor no-hover-padding" href=#zhao-chu-yi-jian-li-de-lian-jie><span aria-hidden=true class=link-icon></span></a> 找出已建立的连接</h3><p>你也可以显示任何已经连接的连接。<pre class=z-code><code><span class="z-text z-plain"># lsof -i -sTCP:ESTABLISHED
</span></code></pre><p>你也可以通过grep搜索“ESTABLISHED”来完成该任务。<pre class=z-code><code><span class="z-text z-plain"># lsof -i | grep -i ESTABLISHED
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">firefox-b 169 daniel  49u IPv4 0t0 TCP 1.2.3.3:1863->1.2.3.4:http (ESTABLISHED)
</span></code></pre><h2 id=yong-hu-xin-xi><a aria-label="Anchor link for: yong-hu-xin-xi" class="header-anchor no-hover-padding" href=#yong-hu-xin-xi><span aria-hidden=true class=link-icon></span></a> 用户信息</h2><p>你也可以获取各种用户的信息，以及它们在系统上正干着的事情，包括它们的网络活动、对文件的操作等。<h3 id=shi-yong-uxian-shi-zhi-ding-yong-hu-da-kai-liao-shen-me><a aria-label="Anchor link for: shi-yong-uxian-shi-zhi-ding-yong-hu-da-kai-liao-shen-me" class="header-anchor no-hover-padding" href=#shi-yong-uxian-shi-zhi-ding-yong-hu-da-kai-liao-shen-me><span aria-hidden=true class=link-icon></span></a> 使用-u显示指定用户打开了什么</h3><pre class=z-code><code><span class="z-text z-plain"># lsof -u daniel
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">-- snipped --
</span><span class="z-text z-plain">Dock 155 daniel  txt REG   14,2   2798436   823208 /usr/lib/libicucore.A.dylib
</span><span class="z-text z-plain">Dock 155 daniel  txt REG   14,2   1580212   823126 /usr/lib/libobjc.A.dylib
</span><span class="z-text z-plain">Dock 155 daniel  txt REG   14,2   2934184   823498 /usr/lib/libstdc++.6.0.4.dylib
</span><span class="z-text z-plain">Dock 155 daniel  txt REG   14,2    132008   823505 /usr/lib/libgcc_s.1.dylib
</span><span class="z-text z-plain">Dock 155 daniel  txt REG   14,2    212160   823214 /usr/lib/libauto.dylib
</span><span class="z-text z-plain">-- snipped --
</span></code></pre><h3 id=shi-yong-u-userlai-xian-shi-chu-zhi-ding-yong-hu-yi-wai-de-qi-ta-suo-you-yong-hu-suo-zuo-de-shi-qing><a aria-label="Anchor link for: shi-yong-u-userlai-xian-shi-chu-zhi-ding-yong-hu-yi-wai-de-qi-ta-suo-you-yong-hu-suo-zuo-de-shi-qing" class="header-anchor no-hover-padding" href=#shi-yong-u-userlai-xian-shi-chu-zhi-ding-yong-hu-yi-wai-de-qi-ta-suo-you-yong-hu-suo-zuo-de-shi-qing><span aria-hidden=true class=link-icon></span></a> 使用-u user来显示除指定用户以外的其它所有用户所做的事情</h3><pre class=z-code><code><span class="z-text z-plain"># lsof -u ^daniel
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">-- snipped --
</span><span class="z-text z-plain">Dock 155 jim  txt REG   14,2   2798436   823208 /usr/lib/libicucore.A.dylib
</span><span class="z-text z-plain">Dock 155 jim  txt REG   14,2   1580212   823126 /usr/lib/libobjc.A.dylib
</span><span class="z-text z-plain">Dock 155 jim  txt REG   14,2   2934184   823498 /usr/lib/libstdc++.6.0.4.dylib
</span><span class="z-text z-plain">Dock 155 jim  txt REG   14,2    132008   823505 /usr/lib/libgcc_s.1.dylib
</span><span class="z-text z-plain">Dock 155 jim  txt REG   14,2    212160   823214 /usr/lib/libauto.dylib
</span><span class="z-text z-plain">-- snipped --
</span></code></pre><h3 id=sha-si-zhi-ding-yong-hu-suo-zuo-de-yi-qie-shi-qing><a aria-label="Anchor link for: sha-si-zhi-ding-yong-hu-suo-zuo-de-yi-qie-shi-qing" class="header-anchor no-hover-padding" href=#sha-si-zhi-ding-yong-hu-suo-zuo-de-yi-qie-shi-qing><span aria-hidden=true class=link-icon></span></a> 杀死指定用户所做的一切事情</h3><p>可以消灭指定用户运行的所有东西，这真不错。<pre class=z-code><code><span class="z-text z-plain"># kill -9 `lsof -t -u daniel`
</span></code></pre><h2 id=ming-ling-he-jin-cheng><a aria-label="Anchor link for: ming-ling-he-jin-cheng" class="header-anchor no-hover-padding" href=#ming-ling-he-jin-cheng><span aria-hidden=true class=link-icon></span></a> 命令和进程</h2><p>可以查看指定程序或进程由什么启动，这通常会很有用，而你可以使用lsof通过名称或进程ID过滤来完成这个任务。下面列出了一些选项：<h3 id=shi-yong-ccha-kan-zhi-ding-de-ming-ling-zheng-zai-shi-yong-de-wen-jian-he-wang-luo-lian-jie><a aria-label="Anchor link for: shi-yong-ccha-kan-zhi-ding-de-ming-ling-zheng-zai-shi-yong-de-wen-jian-he-wang-luo-lian-jie" class="header-anchor no-hover-padding" href=#shi-yong-ccha-kan-zhi-ding-de-ming-ling-zheng-zai-shi-yong-de-wen-jian-he-wang-luo-lian-jie><span aria-hidden=true class=link-icon></span></a> 使用<code>-c</code>查看指定的命令正在使用的文件和网络连接</h3><pre class=z-code><code><span class="z-text z-plain"># lsof -c syslog-ng
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">COMMAND    PID USER   FD   TYPE     DEVICE    SIZE       NODE NAME
</span><span class="z-text z-plain">syslog-ng 7547 root  cwd    DIR    3,3    4096   2 /
</span><span class="z-text z-plain">syslog-ng 7547 root  rtd    DIR    3,3    4096   2 /
</span><span class="z-text z-plain">syslog-ng 7547 root  txt    REG    3,3  113524  1064970 /usr/sbin/syslog-ng
</span><span class="z-text z-plain">-- snipped --
</span></code></pre><h3 id=shi-yong-pcha-kan-zhi-ding-jin-cheng-idyi-da-kai-de-nei-rong><a aria-label="Anchor link for: shi-yong-pcha-kan-zhi-ding-jin-cheng-idyi-da-kai-de-nei-rong" class="header-anchor no-hover-padding" href=#shi-yong-pcha-kan-zhi-ding-jin-cheng-idyi-da-kai-de-nei-rong><span aria-hidden=true class=link-icon></span></a> 使用-p查看指定进程ID已打开的内容</h3><pre class=z-code><code><span class="z-text z-plain"># lsof -p 10075
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">-- snipped --
</span><span class="z-text z-plain">sshd    10068 root  mem    REG    3,3   34808 850407 /lib/libnss_files-2.4.so
</span><span class="z-text z-plain">sshd    10068 root  mem    REG    3,3   34924 850409 /lib/libnss_nis-2.4.so
</span><span class="z-text z-plain">sshd    10068 root  mem    REG    3,3   26596 850405 /lib/libnss_compat-2.4.so
</span><span class="z-text z-plain">sshd    10068 root  mem    REG    3,3  200152 509940 /usr/lib/libssl.so.0.9.7
</span><span class="z-text z-plain">sshd    10068 root  mem    REG    3,3   46216 510014 /usr/lib/liblber-2.3
</span><span class="z-text z-plain">sshd    10068 root  mem    REG    3,3   59868 850413 /lib/libresolv-2.4.so
</span><span class="z-text z-plain">sshd    10068 root  mem    REG    3,3 1197180 850396 /lib/libc-2.4.so
</span><span class="z-text z-plain">sshd    10068 root  mem    REG    3,3   22168 850398 /lib/libcrypt-2.4.so
</span><span class="z-text z-plain">sshd    10068 root  mem    REG    3,3   72784 850404 /lib/libnsl-2.4.so
</span><span class="z-text z-plain">sshd    10068 root  mem    REG    3,3   70632 850417 /lib/libz.so.1.2.3
</span><span class="z-text z-plain">sshd    10068 root  mem    REG    3,3    9992 850416 /lib/libutil-2.4.so
</span><span class="z-text z-plain">-- snipped --
</span></code></pre><h3 id=txuan-xiang-zhi-fan-hui-pid><a aria-label="Anchor link for: txuan-xiang-zhi-fan-hui-pid" class="header-anchor no-hover-padding" href=#txuan-xiang-zhi-fan-hui-pid><span aria-hidden=true class=link-icon></span></a> -t选项只返回PID</h3><pre class=z-code><code><span class="z-text z-plain"># lsof -t -c Mail
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">350
</span></code></pre><h2 id=wen-jian-he-mu-lu><a aria-label="Anchor link for: wen-jian-he-mu-lu" class="header-anchor no-hover-padding" href=#wen-jian-he-mu-lu><span aria-hidden=true class=link-icon></span></a> 文件和目录</h2><p>通过查看指定文件或目录，你可以看到系统上所有正与其交互的资源——包括用户、进程等。<h3 id=xian-shi-yu-zhi-ding-mu-lu-jiao-hu-de-suo-you-yi-qie><a aria-label="Anchor link for: xian-shi-yu-zhi-ding-mu-lu-jiao-hu-de-suo-you-yi-qie" class="header-anchor no-hover-padding" href=#xian-shi-yu-zhi-ding-mu-lu-jiao-hu-de-suo-you-yi-qie><span aria-hidden=true class=link-icon></span></a> 显示与指定目录交互的所有一切</h3><pre class=z-code><code><span class="z-text z-plain"># lsof /var/log/messages/
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">COMMAND    PID USER   FD   TYPE DEVICE   SIZE   NODE NAME
</span><span class="z-text z-plain">syslog-ng 7547 root    4w   REG    3,3 217309 834024 /var/log/messages
</span></code></pre><h3 id=xian-shi-yu-zhi-ding-wen-jian-jiao-hu-de-suo-you-yi-qie><a aria-label="Anchor link for: xian-shi-yu-zhi-ding-wen-jian-jiao-hu-de-suo-you-yi-qie" class="header-anchor no-hover-padding" href=#xian-shi-yu-zhi-ding-wen-jian-jiao-hu-de-suo-you-yi-qie><span aria-hidden=true class=link-icon></span></a> 显示与指定文件交互的所有一切</h3><pre class=z-code><code><span class="z-text z-plain"># lsof /home/daniel/firewall_whitelist.txt
</span></code></pre><h2 id=gao-ji-yong-fa><a aria-label="Anchor link for: gao-ji-yong-fa" class="header-anchor no-hover-padding" href=#gao-ji-yong-fa><span aria-hidden=true class=link-icon></span></a> 高级用法</h2><p>与tcpdump类似，当你开始组合查询时，它就显示了它强大的功能。<h3 id=xian-shi-daniellian-jie-dao-1-1-1-1suo-zuo-de-yi-qie><a aria-label="Anchor link for: xian-shi-daniellian-jie-dao-1-1-1-1suo-zuo-de-yi-qie" class="header-anchor no-hover-padding" href=#xian-shi-daniellian-jie-dao-1-1-1-1suo-zuo-de-yi-qie><span aria-hidden=true class=link-icon></span></a> 显示daniel连接到1.1.1.1所做的一切</h3><pre class=z-code><code><span class="z-text z-plain"># lsof -u daniel -i @1.1.1.1
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">bkdr   1893 daniel 3u  IPv6 3456 TCP 10.10.1.10:1234->1.1.1.1:31337 (ESTABLISHED)
</span></code></pre><h3 id=tong-shi-shi-yong-the-cxuan-xiang-yi-gei-jin-cheng-fa-song-hup-xin-hao><a aria-label="Anchor link for: tong-shi-shi-yong-the-cxuan-xiang-yi-gei-jin-cheng-fa-song-hup-xin-hao" class="header-anchor no-hover-padding" href=#tong-shi-shi-yong-the-cxuan-xiang-yi-gei-jin-cheng-fa-song-hup-xin-hao><span aria-hidden=true class=link-icon></span></a> 同时使用-t和-c选项以给进程发送 HUP 信号</h3><pre class=z-code><code><span class="z-text z-plain"># kill -HUP `lsof -t -c sshd`
</span></code></pre><h3 id=lsof-l1xian-shi-suo-you-da-kai-de-lian-jie-shu-xiao-yu-1de-wen-jian><a aria-label="Anchor link for: lsof-l1xian-shi-suo-you-da-kai-de-lian-jie-shu-xiao-yu-1de-wen-jian" class="header-anchor no-hover-padding" href=#lsof-l1xian-shi-suo-you-da-kai-de-lian-jie-shu-xiao-yu-1de-wen-jian><span aria-hidden=true class=link-icon></span></a> lsof +L1显示所有打开的链接数小于1的文件</h3><p>这通常（当不总是）表示某个攻击者正尝试通过删除文件入口来隐藏文件内容。<pre class=z-code><code><span class="z-text z-plain"># lsof +L1
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">(hopefully nothing)
</span></code></pre><h3 id=xian-shi-mou-ge-duan-kou-fan-wei-de-da-kai-de-lian-jie><a aria-label="Anchor link for: xian-shi-mou-ge-duan-kou-fan-wei-de-da-kai-de-lian-jie" class="header-anchor no-hover-padding" href=#xian-shi-mou-ge-duan-kou-fan-wei-de-da-kai-de-lian-jie><span aria-hidden=true class=link-icon></span></a> 显示某个端口范围的打开的连接</h3><pre class=z-code><code><span class="z-text z-plain"># lsof -i @fw.google.com:2150=2180
</span></code></pre><h2 id=jie-wei><a aria-label="Anchor link for: jie-wei" class="header-anchor no-hover-padding" href=#jie-wei><span aria-hidden=true class=link-icon></span></a> 结尾</h2><p>本入门教程只是管窥了lsof功能的一斑，要查看完整参考，运行man lsof命令或查看在线版本。希望本文对你有所助益，也随时欢迎你的评论和指正。<h2 id=zi-yuan><a aria-label="Anchor link for: zi-yuan" class="header-anchor no-hover-padding" href=#zi-yuan><span aria-hidden=true class=link-icon></span></a> 资源</h2><p>lsof手册页：<a rel="noopener nofollow noreferrer" class=external href=http://www.netadmintools.com/html/lsof.man.html target=_blank>http://www.netadmintools.com/html/lsof.man.html</a> 本文由 Daniel Miessler撰写，首次在他<a rel="noopener nofollow noreferrer" class=external href=http://danielmiessler.com/study/lsof/ target=_blank>博客</a>上贴出<hr><blockquote><p>转自 <a rel="noopener nofollow noreferrer" class=external href=https://linux.cn/article-4099-2.html target=_blank>Linux中国</a></blockquote><p>via: <a rel="noopener nofollow noreferrer" class=external href=http://linuxaria.com/howto/linux-terminal-an-lsof-primer target=_blank>http://linuxaria.com/howto/linux-terminal-an-lsof-primer</a> 作者：<a href="https://plus.google.com/101727609700016666852/posts?rel=author" rel="noopener nofollow noreferrer" class=external target=_blank>Daniel Miessler</a> 译者：<a rel="noopener nofollow noreferrer" class=external href=https://github.com/GOLinux target=_blank>GOLinux</a> 校对：<a rel="noopener nofollow noreferrer" class=external href=https://github.com/wxy target=_blank>wxy</a><p>本文由 <a rel="noopener nofollow noreferrer" class=external href=https://github.com/LCTT/TranslateProject target=_blank>LCTT</a> 原创翻译</section></article></main><div id=button-container><div id=toc-floating-container><input class=toggle id=toc-toggle type=checkbox><label class=button for=toc-toggle id=toc-button title=切换目录><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="M414.82-193.094q-18.044 0-30.497-12.32-12.453-12.319-12.453-30.036t12.453-30.086q12.453-12.37 30.497-12.37h392.767q17.237 0 29.927 12.487 12.69 12.486 12.69 30.203 0 17.716-12.69 29.919t-29.927 12.203H414.82Zm0-244.833q-18.044 0-30.497-12.487Q371.87-462.9 371.87-480.45t12.453-29.92q12.453-12.369 30.497-12.369h392.767q17.237 0 29.927 12.511 12.69 12.512 12.69 29.845 0 17.716-12.69 30.086-12.69 12.37-29.927 12.37H414.82Zm0-245.167q-18.044 0-30.497-12.32t-12.453-30.037q0-17.716 12.453-30.086 12.453-12.369 30.497-12.369h392.767q17.237 0 29.927 12.486 12.69 12.487 12.69 30.203 0 17.717-12.69 29.92-12.69 12.203-29.927 12.203H414.82ZM189.379-156.681q-32.652 0-55.878-22.829t-23.226-55.731q0-32.549 23.15-55.647 23.151-23.097 55.95-23.097 32.799 0 55.313 23.484 22.515 23.484 22.515 56.246 0 32.212-22.861 54.893-22.861 22.681-54.963 22.681Zm0-245.167q-32.652 0-55.878-23.134-23.226-23.135-23.226-55.623 0-32.487 23.467-55.517t56.12-23.03q32.102 0 54.721 23.288 22.62 23.288 22.62 55.775 0 32.488-22.861 55.364-22.861 22.877-54.963 22.877Zm-.82-244.833q-32.224 0-55.254-23.288-23.03-23.289-23.03-55.623 0-32.333 23.271-55.364 23.272-23.03 55.495-23.03 32.224 0 55.193 23.288 22.969 23.289 22.969 55.622 0 32.334-23.21 55.364-23.21 23.031-55.434 23.031Z"/></svg></label><div class=toc-content><div class=toc-container><ul><li><a href=https://inhere.github.io/blog/2016/lsof-command-usage-in-linux/#guan-jian-xuan-xiang>关键选项</a><li><a href=https://inhere.github.io/blog/2016/lsof-command-usage-in-linux/#huo-qu-wang-luo-xin-xi>获取网络信息</a> <ul><li><a href=https://inhere.github.io/blog/2016/lsof-command-usage-in-linux/#shi-yong-ixian-shi-suo-you-lian-jie>使用-i显示所有连接</a><li><a href=https://inhere.github.io/blog/2016/lsof-command-usage-in-linux/#shi-yong-i-6jin-huo-qu-ipv6liu-liang>使用-i 6仅获取IPv6流量</a><li><a href=https://inhere.github.io/blog/2016/lsof-command-usage-in-linux/#jin-xian-shi-tcplian-jie-tong-li-ke-huo-de-udplian-jie>仅显示TCP连接（同理可获得UDP连接）</a></ul><li><a href=https://inhere.github.io/blog/2016/lsof-command-usage-in-linux/#lsof-itcp>lsof -iTCP</a> <ul><li><a href=https://inhere.github.io/blog/2016/lsof-command-usage-in-linux/#shi-yong-i-portlai-xian-shi-yu-zhi-ding-duan-kou-xiang-guan-de-wang-luo-xin-xi>使用-i:port来显示与指定端口相关的网络信息</a><li><a href=https://inhere.github.io/blog/2016/lsof-command-usage-in-linux/#shi-yong-hostlai-xian-shi-zhi-ding-dao-zhi-ding-zhu-ji-de-lian-jie>使用@host来显示指定到指定主机的连接</a><li><a href=https://inhere.github.io/blog/2016/lsof-command-usage-in-linux/#shi-yong-host-portxian-shi-ji-yu-zhu-ji-yu-duan-kou-de-lian-jie>使用@host:port显示基于主机与端口的连接</a><li><a href=https://inhere.github.io/blog/2016/lsof-command-usage-in-linux/#zhao-chu-jian-ting-duan-kou>找出监听端口</a><li><a href=https://inhere.github.io/blog/2016/lsof-command-usage-in-linux/#zhao-chu-yi-jian-li-de-lian-jie>找出已建立的连接</a><li><a href=https://inhere.github.io/blog/2016/lsof-command-usage-in-linux/#yong-hu-xin-xi>用户信息</a> <ul><li><a href=https://inhere.github.io/blog/2016/lsof-command-usage-in-linux/#shi-yong-uxian-shi-zhi-ding-yong-hu-da-kai-liao-shen-me>使用-u显示指定用户打开了什么</a><li><a href=https://inhere.github.io/blog/2016/lsof-command-usage-in-linux/#shi-yong-u-userlai-xian-shi-chu-zhi-ding-yong-hu-yi-wai-de-qi-ta-suo-you-yong-hu-suo-zuo-de-shi-qing>使用-u user来显示除指定用户以外的其它所有用户所做的事情</a><li><a href=https://inhere.github.io/blog/2016/lsof-command-usage-in-linux/#sha-si-zhi-ding-yong-hu-suo-zuo-de-yi-qie-shi-qing>杀死指定用户所做的一切事情</a></ul><li><a href=https://inhere.github.io/blog/2016/lsof-command-usage-in-linux/#ming-ling-he-jin-cheng>命令和进程</a> <ul><li><a href=https://inhere.github.io/blog/2016/lsof-command-usage-in-linux/#shi-yong-ccha-kan-zhi-ding-de-ming-ling-zheng-zai-shi-yong-de-wen-jian-he-wang-luo-lian-jie>使用-c查看指定的命令正在使用的文件和网络连接</a><li><a href=https://inhere.github.io/blog/2016/lsof-command-usage-in-linux/#shi-yong-pcha-kan-zhi-ding-jin-cheng-idyi-da-kai-de-nei-rong>使用-p查看指定进程ID已打开的内容</a><li><a href=https://inhere.github.io/blog/2016/lsof-command-usage-in-linux/#txuan-xiang-zhi-fan-hui-pid>-t选项只返回PID</a></ul><li><a href=https://inhere.github.io/blog/2016/lsof-command-usage-in-linux/#wen-jian-he-mu-lu>文件和目录</a> <ul><li><a href=https://inhere.github.io/blog/2016/lsof-command-usage-in-linux/#xian-shi-yu-zhi-ding-mu-lu-jiao-hu-de-suo-you-yi-qie>显示与指定目录交互的所有一切</a><li><a href=https://inhere.github.io/blog/2016/lsof-command-usage-in-linux/#xian-shi-yu-zhi-ding-wen-jian-jiao-hu-de-suo-you-yi-qie>显示与指定文件交互的所有一切</a></ul><li><a href=https://inhere.github.io/blog/2016/lsof-command-usage-in-linux/#gao-ji-yong-fa>高级用法</a> <ul><li><a href=https://inhere.github.io/blog/2016/lsof-command-usage-in-linux/#xian-shi-daniellian-jie-dao-1-1-1-1suo-zuo-de-yi-qie>显示daniel连接到1.1.1.1所做的一切</a><li><a href=https://inhere.github.io/blog/2016/lsof-command-usage-in-linux/#tong-shi-shi-yong-the-cxuan-xiang-yi-gei-jin-cheng-fa-song-hup-xin-hao>同时使用-t和-c选项以给进程发送 HUP 信号</a><li><a href=https://inhere.github.io/blog/2016/lsof-command-usage-in-linux/#lsof-l1xian-shi-suo-you-da-kai-de-lian-jie-shu-xiao-yu-1de-wen-jian>lsof +L1显示所有打开的链接数小于1的文件</a><li><a href=https://inhere.github.io/blog/2016/lsof-command-usage-in-linux/#xian-shi-mou-ge-duan-kou-fan-wei-de-da-kai-de-lian-jie>显示某个端口范围的打开的连接</a></ul><li><a href=https://inhere.github.io/blog/2016/lsof-command-usage-in-linux/#jie-wei>结尾</a><li><a href=https://inhere.github.io/blog/2016/lsof-command-usage-in-linux/#zi-yuan>资源</a></ul></ul></div></div></div><a class=no-hover-padding href=# id=top-button title=返回页面顶部> <svg viewbox="0 0 20 20" fill=currentColor><path d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z"/></svg> </a></div><span class=hidden id=copy-success> 已复制! </span><span class=hidden id=copy-init> 复制代码到剪贴板 </span><script defer src=https://inhere.github.io/js/copyCodeToClipboard.min.js></script></div><footer><section><nav class="socials nav-navs"><ul><li><a class="nav-links no-hover-padding social" rel="noopener noreferrer" href=https://inhere.github.io/atom.xml target=_blank> <img alt=feed loading=lazy src=https://inhere.github.io/social_icons/rss.svg title=feed> </a><li><a class="nav-links no-hover-padding social" rel="noopener noreferrer me" href=https://github.com/inhere/ target=_blank> <img alt=github loading=lazy src=https://inhere.github.io/social_icons/github.svg title=github> </a></ul></nav><nav class=nav-navs><small> <ul><li><a class="nav-links no-hover-padding" href=https://inhere.github.io/pages/about> 🐶 About </a><li><a class="nav-links no-hover-padding" href=https://github.com/gookit> 🐱 Gookit </a><li><a class="nav-links no-hover-padding" href=https://github.com/phppkg> 🐱 PHPPkg </a><li><a class="nav-links no-hover-padding" href=https://inhere.github.io/sitemap.xml> 📄 Sitemap </a></ul> </small></nav><div class=credits><small> 网站基于 <a rel="noopener noreferrer" href=https://www.getzola.org target=_blank>Zola</a> 和 <a rel="noopener noreferrer" href=https://github.com/welpo/tabi target=_blank>tabi</a> • <a rel="noopener noreferrer" href=https://github.com/inhere/inhere.github.io target=_blank> 查看原始码 </a></small></div></section></footer>